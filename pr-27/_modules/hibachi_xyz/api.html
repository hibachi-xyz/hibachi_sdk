

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>hibachi_xyz.api &mdash; hibachi_xyz 0.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=938c9ccc"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            hibachi_xyz
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../hibachi_xyz.html">hibachi_xyz package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">hibachi_xyz</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">hibachi_xyz.api</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for hibachi_xyz.api</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;HTTP API client for Hibachi XYZ exchange.</span>

<span class="sd">This module provides the main HibachiApiClient class for interacting with the</span>
<span class="sd">Hibachi exchange REST API, including market data queries, account management,</span>
<span class="sd">and order operations.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">hmac</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">asdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">decimal</span><span class="w"> </span><span class="kn">import</span> <span class="n">Decimal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hashlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">sha256</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">time</span><span class="w"> </span><span class="kn">import</span> <span class="n">time_ns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">types</span><span class="w"> </span><span class="kn">import</span> <span class="n">NoneType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">cast</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">eth_keys.datatypes</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">hibachi_xyz.errors</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BadGateway</span><span class="p">,</span>
    <span class="n">BadHttpStatus</span><span class="p">,</span>
    <span class="n">BadRequest</span><span class="p">,</span>
    <span class="n">DeserializationError</span><span class="p">,</span>
    <span class="n">Forbidden</span><span class="p">,</span>
    <span class="n">GatewayTimeout</span><span class="p">,</span>
    <span class="n">InternalServerError</span><span class="p">,</span>
    <span class="n">NotFound</span><span class="p">,</span>
    <span class="n">RateLimited</span><span class="p">,</span>
    <span class="n">ServiceUnavailable</span><span class="p">,</span>
    <span class="n">Unauthorized</span><span class="p">,</span>
    <span class="n">ValidationError</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hibachi_xyz.executors</span><span class="w"> </span><span class="kn">import</span> <span class="n">DEFAULT_HTTP_EXECUTOR</span><span class="p">,</span> <span class="n">HttpExecutor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hibachi_xyz.executors.interface</span><span class="w"> </span><span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hibachi_xyz.helpers</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">DEFAULT_API_URL</span><span class="p">,</span>
    <span class="n">DEFAULT_DATA_API_URL</span><span class="p">,</span>
    <span class="n">absolute_creation_deadline</span><span class="p">,</span>
    <span class="n">check_maintenance_window</span><span class="p">,</span>
    <span class="n">create_with</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hibachi_xyz.types</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">AccountInfo</span><span class="p">,</span>
    <span class="n">AccountTrade</span><span class="p">,</span>
    <span class="n">AccountTradesResponse</span><span class="p">,</span>
    <span class="n">Asset</span><span class="p">,</span>
    <span class="n">BatchResponse</span><span class="p">,</span>
    <span class="n">CancelOrder</span><span class="p">,</span>
    <span class="n">CapitalBalance</span><span class="p">,</span>
    <span class="n">CapitalHistory</span><span class="p">,</span>
    <span class="n">CreateOrder</span><span class="p">,</span>
    <span class="n">CreateOrderBatchResponse</span><span class="p">,</span>
    <span class="n">CrossChainAsset</span><span class="p">,</span>
    <span class="n">DepositInfo</span><span class="p">,</span>
    <span class="n">ErrorBatchResponse</span><span class="p">,</span>
    <span class="n">ExchangeInfo</span><span class="p">,</span>
    <span class="n">FeeConfig</span><span class="p">,</span>
    <span class="n">FundingRateEstimation</span><span class="p">,</span>
    <span class="n">FutureContract</span><span class="p">,</span>
    <span class="n">HibachiNumericInput</span><span class="p">,</span>
    <span class="n">Interval</span><span class="p">,</span>
    <span class="n">InventoryResponse</span><span class="p">,</span>
    <span class="n">Json</span><span class="p">,</span>
    <span class="n">JsonArray</span><span class="p">,</span>
    <span class="n">JsonObject</span><span class="p">,</span>
    <span class="n">Kline</span><span class="p">,</span>
    <span class="n">KlinesResponse</span><span class="p">,</span>
    <span class="n">MaintenanceWindow</span><span class="p">,</span>
    <span class="n">Market</span><span class="p">,</span>
    <span class="n">MarketInfo</span><span class="p">,</span>
    <span class="n">Nonce</span><span class="p">,</span>
    <span class="n">OpenInterestResponse</span><span class="p">,</span>
    <span class="n">Order</span><span class="p">,</span>
    <span class="n">OrderBook</span><span class="p">,</span>
    <span class="n">OrderBookLevel</span><span class="p">,</span>
    <span class="n">OrderFlags</span><span class="p">,</span>
    <span class="n">OrderId</span><span class="p">,</span>
    <span class="n">OrderIdVariant</span><span class="p">,</span>
    <span class="n">OrderType</span><span class="p">,</span>
    <span class="n">PendingOrdersResponse</span><span class="p">,</span>
    <span class="n">Position</span><span class="p">,</span>
    <span class="n">PriceResponse</span><span class="p">,</span>
    <span class="n">Settlement</span><span class="p">,</span>
    <span class="n">SettlementsResponse</span><span class="p">,</span>
    <span class="n">Side</span><span class="p">,</span>
    <span class="n">StatsResponse</span><span class="p">,</span>
    <span class="n">TakerSide</span><span class="p">,</span>
    <span class="n">TPSLConfig</span><span class="p">,</span>
    <span class="n">Trade</span><span class="p">,</span>
    <span class="n">TradesResponse</span><span class="p">,</span>
    <span class="n">TradingTier</span><span class="p">,</span>
    <span class="n">Transaction</span><span class="p">,</span>
    <span class="n">TransferRequest</span><span class="p">,</span>
    <span class="n">TransferResponse</span><span class="p">,</span>
    <span class="n">TriggerDirection</span><span class="p">,</span>
    <span class="n">TWAPConfig</span><span class="p">,</span>
    <span class="n">UpdateOrder</span><span class="p">,</span>
    <span class="n">WithdrawalLimit</span><span class="p">,</span>
    <span class="n">WithdrawRequest</span><span class="p">,</span>
    <span class="n">WithdrawResponse</span><span class="p">,</span>
    <span class="n">deserialize_batch_response_order</span><span class="p">,</span>
    <span class="n">full_precision_string</span><span class="p">,</span>
    <span class="n">numeric_to_decimal</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="raise_response_errors">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.raise_response_errors">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">raise_response_errors</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">HttpResponse</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check HTTP response status and raise appropriate errors.</span>

<span class="sd">    Validates the response status code and raises pre-defined exceptions for non-2XX</span>
<span class="sd">    status codes with detailed error messages extracted from the response body.</span>

<span class="sd">    Args:</span>
<span class="sd">        response: The HTTP response to validate</span>

<span class="sd">    Raises:</span>
<span class="sd">        BadRequest: For 400 status codes</span>
<span class="sd">        Unauthorized: For 401 status codes</span>
<span class="sd">        Forbidden: For 403 status codes</span>
<span class="sd">        NotFound: For 404 status codes</span>
<span class="sd">        RateLimited: For 429 status codes with rate limit details</span>
<span class="sd">        BadHttpStatus: For other 4XX status codes</span>
<span class="sd">        InternalServerError: For 500 status codes</span>
<span class="sd">        BadGateway: For 502 status codes</span>
<span class="sd">        ServiceUnavailable: For 503 status codes</span>
<span class="sd">        GatewayTimeout: For 504 status codes</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span>

    <span class="c1"># Success status codes (2xx)</span>
    <span class="k">if</span> <span class="mi">200</span> <span class="o">&lt;=</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Extract error message from response body if available</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="p">{}</span>

    <span class="c1"># Try to extract common Hibachi error fields</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;errorCode&quot;</span><span class="p">)</span>
    <span class="n">app_status</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span>

    <span class="c1"># Construct error message based on available fields</span>
    <span class="k">if</span> <span class="n">code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">app_status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">message</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">app_status</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="p">)</span> <span class="k">if</span> <span class="n">body</span> <span class="k">else</span> <span class="s2">&quot;&lt;no error message&gt;&quot;</span>

    <span class="c1"># 4xx Client Errors</span>
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">400</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Bad request: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Unauthorized</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unauthorized: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">403</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Forbidden</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Forbidden: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
        <span class="c1"># TODO potentially coalesce into MaintenanceWindow with additional query</span>
        <span class="k">raise</span> <span class="n">NotFound</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Not found: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
        <span class="c1"># Extract rate limit specific fields</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>  <span class="c1"># name of the limit hit</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>  <span class="c1"># current count of the action</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">)</span>  <span class="c1"># maximum count before limit is reached</span>
        <span class="n">window_duration</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;windowDuration&quot;</span>
        <span class="p">)</span>  <span class="c1"># optional (duration after which count is reset)</span>

        <span class="c1"># Construct detailed rate limit message</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rate_limit_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Rate limit &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; exceeded: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">window_duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rate_limit_msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (resets after </span><span class="si">{</span><span class="n">window_duration</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rate_limit_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Rate limit exceeded: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">raise</span> <span class="n">RateLimited</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">rate_limit_msg</span><span class="p">)</span>

    <span class="c1"># Other 4xx errors</span>
    <span class="k">if</span> <span class="mi">400</span> <span class="o">&lt;=</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">BadHttpStatus</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Client error (</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 5xx Server Errors</span>
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">500</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InternalServerError</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Internal server error: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">502</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">BadGateway</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Bad gateway: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">503</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ServiceUnavailable</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Service unavailable: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">504</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">GatewayTimeout</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Gateway timeout: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Other 5xx errors</span>
    <span class="k">if</span> <span class="mi">500</span> <span class="o">&lt;=</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InternalServerError</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Server error (</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 3xx Redirects or other unexpected status codes</span>
    <span class="c1"># This shouldn&#39;t normally happen in an API context, but handle it just in case</span>
    <span class="k">raise</span> <span class="n">BadHttpStatus</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unexpected status code (</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="price_to_bytes">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.price_to_bytes">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">price_to_bytes</span><span class="p">(</span><span class="n">price</span><span class="p">:</span> <span class="n">HibachiNumericInput</span><span class="p">,</span> <span class="n">contract</span><span class="p">:</span> <span class="n">FutureContract</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert price to bytes representation for signing.</span>

<span class="sd">    Converts a price value to an 8-byte representation adjusted for contract</span>
<span class="sd">    decimals and scaled by 2^32 for fixed-point representation.</span>

<span class="sd">    Args:</span>
<span class="sd">        price: The price value to convert</span>
<span class="sd">        contract: The future contract containing decimal precision info</span>

<span class="sd">    Returns:</span>
<span class="sd">        bytes: 8-byte big-endian representation of the scaled price</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span>
        <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
        <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">),</span> <span class="mi">32</span><span class="p">)</span>
        <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;10&quot;</span><span class="p">),</span> <span class="n">contract</span><span class="o">.</span><span class="n">settlementDecimals</span> <span class="o">-</span> <span class="n">contract</span><span class="o">.</span><span class="n">underlyingDecimals</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="HibachiApiClient">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">HibachiApiClient</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Hibachi API client for trading operations.</span>

<span class="sd">    Examples:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            from hibachi_xyz import HibachiApiClient</span>
<span class="sd">            from dotenv import load_dotenv</span>
<span class="sd">            import os</span>

<span class="sd">            load_dotenv()</span>

<span class="sd">            hibachi = HibachiApiClient(</span>
<span class="sd">                api_key=os.environ.get(&#39;HIBACHI_API_KEY&#39;, &quot;your-api-key&quot;),</span>
<span class="sd">                account_id=os.environ.get(&#39;HIBACHI_ACCOUNT_ID&#39;, &quot;your-account-id&quot;),</span>
<span class="sd">                private_key=os.environ.get(&#39;HIBACHI_PRIVATE_KEY&#39;, &quot;your-private&quot;),</span>
<span class="sd">            )</span>

<span class="sd">            account_info = hibachi.get_account_info()</span>
<span class="sd">            print(f&quot;Account Balance: {account_info.balance}&quot;)</span>
<span class="sd">            print(f&quot;Total Position Notional: {account_info.totalPositionNotional}&quot;)</span>

<span class="sd">            exchange_info = hibachi.get_exchange_info()</span>
<span class="sd">            print(exchange_info)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_account_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_private_key</span><span class="p">:</span> <span class="n">eth_keys</span><span class="o">.</span><span class="n">datatypes</span><span class="o">.</span><span class="n">PrivateKey</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="p">(</span>
        <span class="kc">None</span>  <span class="c1"># ECDSA for wallet account</span>
    <span class="p">)</span>
    <span class="n">_private_key_hmac</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># HMAC for web account</span>

    <span class="n">_future_contracts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FutureContract</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_http_executor</span><span class="p">:</span> <span class="n">HttpExecutor</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">api_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_API_URL</span><span class="p">,</span>
        <span class="n">data_api_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_DATA_API_URL</span><span class="p">,</span>
        <span class="n">account_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">executor</span><span class="p">:</span> <span class="n">HttpExecutor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Hibachi API client.</span>

<span class="sd">        Args:</span>
<span class="sd">            api_url: Base URL for the Hibachi API (default: production URL)</span>
<span class="sd">            data_api_url: Base URL for the data API (default: production data URL)</span>
<span class="sd">            account_id: Your Hibachi account ID (optional, can be set later)</span>
<span class="sd">            api_key: Your API key for authentication (optional, can be set later)</span>
<span class="sd">            private_key: Private key for signing requests (hex string with or without 0x prefix,</span>
<span class="sd">                or HMAC key for web accounts)</span>
<span class="sd">            executor: Custom HTTP executor (optional, uses default if not provided)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">private_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_private_key</span><span class="p">(</span><span class="n">private_key</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_http_executor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">executor</span>
            <span class="k">if</span> <span class="n">executor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">DEFAULT_HTTP_EXECUTOR</span><span class="p">(</span>
                <span class="n">api_url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span>
                <span class="n">data_api_url</span><span class="o">=</span><span class="n">data_api_url</span><span class="p">,</span>
                <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_api_key</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_account_id</span><span class="p">(</span><span class="n">account_id</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">future_contracts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FutureContract</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the cached future contracts metadata.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, FutureContract]: Dictionary mapping contract symbols to their metadata</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If contracts have not been loaded yet (call get_exchange_info() first)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_future_contracts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;future_contracts not yet loaded&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_future_contracts</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">account_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current account ID.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The account ID</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If account_id has not been set</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_account_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;account_id has not been set&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_account_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">api_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current API key.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The API key</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If api_key has not been set</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_executor</span><span class="o">.</span><span class="n">api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;api_key has not been set&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_executor</span><span class="o">.</span><span class="n">api_key</span>

<div class="viewcode-block" id="HibachiApiClient.set_account_id">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.set_account_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_account_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the account ID for API requests.</span>

<span class="sd">        Args:</span>
<span class="sd">            account_id: The account ID (int, numeric string, or None)</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If the account_id is an invalid type or format</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_account_id</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Any</span><span class="p">,</span> <span class="n">account_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_account_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_account_id</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid </span><span class="si">{</span><span class="n">account_id</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_account_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_account_id</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_account_id</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_account_id</span> <span class="o">=</span> <span class="n">_account_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span> <span class="kn">from</span><span class="w"> </span><span class="nn">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unexpected type for account_id </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">account_id</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="HibachiApiClient.set_api_key">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.set_api_key">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_api_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the API key for authenticated requests.</span>

<span class="sd">        Args:</span>
<span class="sd">            api_key: The API key string (or None to clear)</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If the api_key is an invalid type</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_api_key</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Any</span><span class="p">,</span> <span class="n">api_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_api_key</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span> <span class="kn">from</span><span class="w"> </span><span class="nn">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unexpected type for api_key </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_http_executor</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span></div>


<div class="viewcode-block" id="HibachiApiClient.set_private_key">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.set_private_key">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_private_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the private key for signing requests.</span>

<span class="sd">        Supports two formats:</span>
<span class="sd">            - Ethereum private key (hex string with or without 0x prefix) for wallet accounts</span>
<span class="sd">            - HMAC key (non-hex string) for web accounts</span>

<span class="sd">        Args:</span>
<span class="sd">            private_key: The private key as a hex string (with/without 0x) or HMAC key</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">private_key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;0x&quot;</span><span class="p">):</span>
            <span class="n">private_key</span> <span class="o">=</span> <span class="n">private_key</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="n">private_key_bytes</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">private_key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_private_key</span> <span class="o">=</span> <span class="n">eth_keys</span><span class="o">.</span><span class="n">datatypes</span><span class="o">.</span><span class="n">PrivateKey</span><span class="p">(</span><span class="n">private_key_bytes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">private_key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;0x&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_private_key_hmac</span> <span class="o">=</span> <span class="n">private_key</span></div>


<span class="w">    </span><span class="sd">&quot;&quot;&quot; Market API endpoints, can be called without having an account &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HibachiApiClient.get_exchange_info">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.get_exchange_info">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_exchange_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExchangeInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get exchange metadata and maintenance information.</span>

<span class="sd">        Retrieves all available future contracts, fee configuration, withdrawal limits,</span>
<span class="sd">        and maintenance windows. The maintenance status can be &quot;NORMAL&quot;, &quot;UNSCHEDULED_MAINTENANCE&quot;,</span>
<span class="sd">        or &quot;SCHEDULED_MAINTENANCE&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ExchangeInfo: Exchange metadata including fee config, future contracts,</span>
<span class="sd">                withdrawal limits, maintenance windows, and current status</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>

<span class="sd">        Example:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                exchange_info = client.get_exchange_info()</span>
<span class="sd">                print(exchange_info)</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            GET /market/exchange-info</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">exchange_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_simple_request</span><span class="p">(</span><span class="s2">&quot;/market/exchange-info&quot;</span><span class="p">)</span>
        <span class="n">check_maintenance_window</span><span class="p">(</span><span class="n">exchange_info</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_future_contracts</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">contract</span> <span class="ow">in</span> <span class="n">exchange_info</span><span class="p">[</span><span class="s2">&quot;futureContracts&quot;</span><span class="p">]:</span>  <span class="c1"># type: ignore</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">future_contracts</span><span class="p">[</span><span class="n">contract</span><span class="p">[</span><span class="s2">&quot;symbol&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">create_with</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
                    <span class="n">FutureContract</span><span class="p">,</span>
                    <span class="n">contract</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                <span class="p">)</span>

            <span class="n">fee_config</span> <span class="o">=</span> <span class="n">create_with</span><span class="p">(</span><span class="n">FeeConfig</span><span class="p">,</span> <span class="n">exchange_info</span><span class="p">[</span><span class="s2">&quot;feeConfig&quot;</span><span class="p">])</span>  <span class="c1"># type: ignore</span>

            <span class="c1"># Parse future contracts</span>
            <span class="n">future_contracts</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">create_with</span><span class="p">(</span><span class="n">FutureContract</span><span class="p">,</span> <span class="n">contract</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
                <span class="k">for</span> <span class="n">contract</span> <span class="ow">in</span> <span class="n">exchange_info</span><span class="p">[</span><span class="s2">&quot;futureContracts&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="p">]</span>

            <span class="c1"># Parse withdrawal limit</span>
            <span class="n">withdrawal_limit</span> <span class="o">=</span> <span class="n">create_with</span><span class="p">(</span>
                <span class="n">WithdrawalLimit</span><span class="p">,</span>
                <span class="n">exchange_info</span><span class="p">[</span><span class="s2">&quot;instantWithdrawalLimit&quot;</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
            <span class="p">)</span>

            <span class="c1"># Parse maintenance windows</span>
            <span class="n">maintenance_windows</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">create_with</span><span class="p">(</span><span class="n">MaintenanceWindow</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
                <span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">exchange_info</span><span class="p">[</span><span class="s2">&quot;maintenanceWindow&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="p">]</span>
            <span class="n">status</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">exchange_info</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">exchange_info</span><span class="si">=}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="c1"># Create exchange info object</span>
        <span class="k">return</span> <span class="n">ExchangeInfo</span><span class="p">(</span>
            <span class="n">feeConfig</span><span class="o">=</span><span class="n">fee_config</span><span class="p">,</span>
            <span class="n">futureContracts</span><span class="o">=</span><span class="n">future_contracts</span><span class="p">,</span>
            <span class="n">instantWithdrawalLimit</span><span class="o">=</span><span class="n">withdrawal_limit</span><span class="p">,</span>
            <span class="n">maintenanceWindow</span><span class="o">=</span><span class="n">maintenance_windows</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="HibachiApiClient.get_inventory">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.get_inventory">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InventoryResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get market inventory with contract metadata and latest price information.</span>

<span class="sd">        Similar to get_exchange_info, but includes current price data for all contracts,</span>
<span class="sd">        cross-chain assets, fee configuration, and trading tiers.</span>

<span class="sd">        Returns:</span>
<span class="sd">            InventoryResponse: Market inventory including cross-chain assets, fee config,</span>
<span class="sd">                markets with contract and price info, and trading tiers</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            GET /market/inventory</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">market_inventory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_simple_request</span><span class="p">(</span><span class="s2">&quot;/market/inventory&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_future_contracts</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">market</span> <span class="ow">in</span> <span class="n">market_inventory</span><span class="p">[</span><span class="s2">&quot;markets&quot;</span><span class="p">]:</span>  <span class="c1"># type: ignore</span>
                <span class="n">contract</span> <span class="o">=</span> <span class="n">create_with</span><span class="p">(</span><span class="n">FutureContract</span><span class="p">,</span> <span class="n">market</span><span class="p">[</span><span class="s2">&quot;contract&quot;</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">future_contracts</span><span class="p">[</span><span class="n">contract</span><span class="o">.</span><span class="n">symbol</span><span class="p">]</span> <span class="o">=</span> <span class="n">contract</span>

            <span class="n">markets</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">Market</span><span class="p">(</span>
                    <span class="n">contract</span><span class="o">=</span><span class="n">create_with</span><span class="p">(</span><span class="n">FutureContract</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="s2">&quot;contract&quot;</span><span class="p">]),</span>  <span class="c1"># type: ignore</span>
                    <span class="n">info</span><span class="o">=</span><span class="n">create_with</span><span class="p">(</span><span class="n">MarketInfo</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="s2">&quot;info&quot;</span><span class="p">]),</span>  <span class="c1"># type: ignore</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">market_inventory</span><span class="p">[</span><span class="s2">&quot;markets&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="p">]</span>

            <span class="n">output</span> <span class="o">=</span> <span class="n">InventoryResponse</span><span class="p">(</span>
                <span class="n">crossChainAssets</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">create_with</span><span class="p">(</span><span class="n">CrossChainAsset</span><span class="p">,</span> <span class="n">cca</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
                    <span class="k">for</span> <span class="n">cca</span> <span class="ow">in</span> <span class="n">market_inventory</span><span class="p">[</span><span class="s2">&quot;crossChainAssets&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
                <span class="p">],</span>
                <span class="n">feeConfig</span><span class="o">=</span><span class="n">create_with</span><span class="p">(</span><span class="n">FeeConfig</span><span class="p">,</span> <span class="n">market_inventory</span><span class="p">[</span><span class="s2">&quot;feeConfig&quot;</span><span class="p">]),</span>  <span class="c1"># type: ignore</span>
                <span class="n">markets</span><span class="o">=</span><span class="n">markets</span><span class="p">,</span>
                <span class="n">tradingTiers</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">create_with</span><span class="p">(</span><span class="n">TradingTier</span><span class="p">,</span> <span class="n">tt</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
                    <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">market_inventory</span><span class="p">[</span><span class="s2">&quot;tradingTiers&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">market_inventory</span><span class="si">=}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="k">return</span> <span class="n">output</span></div>


<div class="viewcode-block" id="HibachiApiClient.get_prices">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.get_prices">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_prices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PriceResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current price information for a trading symbol.</span>

<span class="sd">        Retrieves mark price, index price, and funding rate estimation for the specified symbol.</span>

<span class="sd">        Args:</span>
<span class="sd">            symbol: The trading symbol (e.g., &quot;BTC/USDT-P&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            PriceResponse: Price information including mark price, index price, and funding rates</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>
<span class="sd">            HttpConnectionError: If the API request fails</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            GET /market/data/prices</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_simple_request</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/market/data/prices?symbol=</span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span><span class="p">[</span><span class="s2">&quot;fundingRateEstimation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">create_with</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
                <span class="n">FundingRateEstimation</span><span class="p">,</span>
                <span class="n">response</span><span class="p">[</span><span class="s2">&quot;fundingRateEstimation&quot;</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
            <span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">create_with</span><span class="p">(</span><span class="n">PriceResponse</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="HibachiApiClient.get_stats">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.get_stats">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatsResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get 24-hour statistics for a trading symbol.</span>

<span class="sd">        Retrieves 24-hour trading statistics including volume, high/low prices, and price changes.</span>

<span class="sd">        Args:</span>
<span class="sd">            symbol: The trading symbol (e.g., &quot;BTC/USDT-P&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            StatsResponse: 24-hour trading statistics</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>
<span class="sd">            HttpConnectionError: If the API request fails</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            GET /market/data/stats</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_simple_request</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/market/data/stats?symbol=</span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">create_with</span><span class="p">(</span><span class="n">StatsResponse</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="HibachiApiClient.get_trades">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.get_trades">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_trades</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TradesResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get recent trades for a trading symbol.</span>

<span class="sd">        Retrieves the most recent executed trades for the specified symbol.</span>

<span class="sd">        Args:</span>
<span class="sd">            symbol: The trading symbol (e.g., &quot;BTC/USDT-P&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            TradesResponse: List of recent trades with price, quantity, taker side, and timestamp</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>
<span class="sd">            HttpConnectionError: If the API request fails</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            GET /market/data/trades</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_simple_request</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/market/data/trades?symbol=</span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">TradesResponse</span><span class="p">(</span>
                <span class="n">trades</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">Trade</span><span class="p">(</span>
                        <span class="n">price</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
                        <span class="n">quantity</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="s2">&quot;quantity&quot;</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
                        <span class="n">takerSide</span><span class="o">=</span><span class="n">TakerSide</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s2">&quot;takerSide&quot;</span><span class="p">]),</span>  <span class="c1"># type: ignore</span>
                        <span class="n">timestamp</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;trades&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="HibachiApiClient.get_klines">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.get_klines">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_klines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">interval</span><span class="p">:</span> <span class="n">Interval</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KlinesResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get candlestick (K-line) data for a trading symbol.</span>

<span class="sd">        Retrieves historical candlestick data at the specified time interval.</span>

<span class="sd">        Args:</span>
<span class="sd">            symbol: The trading symbol (e.g., &quot;BTC/USDT-P&quot;)</span>
<span class="sd">            interval: The time interval for candlesticks (e.g., Interval.ONE_MINUTE)</span>

<span class="sd">        Returns:</span>
<span class="sd">            KlinesResponse: List of candlestick data with OHLCV information</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>
<span class="sd">            HttpConnectionError: If the API request fails</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            GET /market/data/klines</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_simple_request</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;/market/data/klines?symbol=</span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s2">&amp;interval=</span><span class="si">{</span><span class="n">interval</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">KlinesResponse</span><span class="p">(</span>
                <span class="n">klines</span><span class="o">=</span><span class="p">[</span><span class="n">create_with</span><span class="p">(</span><span class="n">Kline</span><span class="p">,</span> <span class="n">kline</span><span class="p">)</span> <span class="k">for</span> <span class="n">kline</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;klines&quot;</span><span class="p">]]</span>  <span class="c1"># type: ignore</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="HibachiApiClient.get_open_interest">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.get_open_interest">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_open_interest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OpenInterestResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get open interest for a trading symbol.</span>

<span class="sd">        Retrieves the current open interest (total outstanding contracts) for the specified symbol.</span>

<span class="sd">        Args:</span>
<span class="sd">            symbol: The trading symbol (e.g., &quot;BTC/USDT-P&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            OpenInterestResponse: The open interest data</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>
<span class="sd">            HttpConnectionError: If the API request fails</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            GET /market/data/open-interest</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_simple_request</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;/market/data/open-interest?symbol=</span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">create_with</span><span class="p">(</span><span class="n">OpenInterestResponse</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="HibachiApiClient.get_orderbook">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.get_orderbook">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_orderbook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">granularity</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderBook</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get orderbook price levels for a trading symbol.</span>

<span class="sd">        Retrieves aggregated bid and ask price levels from the orderbook. Price levels</span>
<span class="sd">        are aggregated based on the specified granularity.</span>

<span class="sd">        Args:</span>
<span class="sd">            symbol: The trading symbol (e.g., &quot;BTC/USDT-P&quot;)</span>
<span class="sd">            depth: Number of price levels to return on each side (1-100)</span>
<span class="sd">            granularity: Price level granularity for aggregation (e.g., 0.01)</span>

<span class="sd">        Returns:</span>
<span class="sd">            OrderBook: Orderbook with bid and ask price levels containing price and quantity</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If depth is not between 1 and 100, or granularity is not valid</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>
<span class="sd">            HttpConnectionError: If the API request fails</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            GET /market/data/orderbook</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Depth must be a positive integer between 1 and 100, inclusive&quot;</span>
            <span class="p">)</span>

        <span class="n">contract</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_contract</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="n">granularities</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">orderbookGranularities</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">granularity</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">granularities</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Granularity for symbol </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s2"> must be one of </span><span class="si">{</span><span class="n">granularities</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_simple_request</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;/market/data/orderbook?symbol=</span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s2">&amp;depth=</span><span class="si">{</span><span class="n">depth</span><span class="si">}</span><span class="s2">&amp;granularity=</span><span class="si">{</span><span class="n">granularity</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ask_levels</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">OrderBookLevel</span><span class="p">(</span><span class="n">price</span><span class="o">=</span><span class="n">level</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">],</span> <span class="n">quantity</span><span class="o">=</span><span class="n">level</span><span class="p">[</span><span class="s2">&quot;quantity&quot;</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;ask&quot;</span><span class="p">][</span><span class="s2">&quot;levels&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="p">]</span>
            <span class="n">bid_levels</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">OrderBookLevel</span><span class="p">(</span><span class="n">price</span><span class="o">=</span><span class="n">level</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">],</span> <span class="n">quantity</span><span class="o">=</span><span class="n">level</span><span class="p">[</span><span class="s2">&quot;quantity&quot;</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
                <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;bid&quot;</span><span class="p">][</span><span class="s2">&quot;levels&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="p">]</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">OrderBook</span><span class="p">(</span><span class="n">ask</span><span class="o">=</span><span class="n">ask_levels</span><span class="p">,</span> <span class="n">bid</span><span class="o">=</span><span class="n">bid_levels</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="k">return</span> <span class="n">result</span></div>


    <span class="c1">### ===================================================== Account API =====================================================</span>

    <span class="c1">### ------------------------------------------------ Account API - Capital ------------------------------------------------</span>

<div class="viewcode-block" id="HibachiApiClient.get_capital_balance">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.get_capital_balance">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_capital_balance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CapitalBalance</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get account balance including unrealized PnL.</span>

<span class="sd">        Retrieves the net equity balance for your account, which includes</span>
<span class="sd">        unrealized profit and loss from open positions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            CapitalBalance: Account balance as a string</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>

<span class="sd">        Example:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                capital_balance = client.get_capital_balance()</span>
<span class="sd">                print(capital_balance.balance)</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            GET /capital/balance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_authorized_request</span><span class="p">(</span>
            <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/capital/balance?accountId=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">account_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">create_with</span><span class="p">(</span><span class="n">CapitalBalance</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="HibachiApiClient.get_capital_history">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.get_capital_history">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_capital_history</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CapitalHistory</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get deposit and withdrawal history for your account.</span>

<span class="sd">        Retrieves the most recent deposit and withdrawal transactions, up to</span>
<span class="sd">        100 of each transaction type.</span>

<span class="sd">        Returns:</span>
<span class="sd">            CapitalHistory: List of transactions including deposits and withdrawals</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>

<span class="sd">        Example:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                capital_history = client.get_capital_history()</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            GET /capital/history</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_authorized_request</span><span class="p">(</span>
            <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/capital/history?accountId=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">account_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">CapitalHistory</span><span class="p">(</span>
                <span class="n">transactions</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">create_with</span><span class="p">(</span><span class="n">Transaction</span><span class="p">,</span> <span class="n">tx</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
                    <span class="k">for</span> <span class="n">tx</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;transactions&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="HibachiApiClient.withdraw">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.withdraw">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">withdraw</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">coin</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">withdraw_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">max_fees</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">network</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;arbitrum&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WithdrawResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Submit a withdrawal request.</span>

<span class="sd">        Submits a request to withdraw funds to an external address. The quantity</span>
<span class="sd">        must not exceed the maximalWithdraw value returned by get_account_info().</span>

<span class="sd">        Args:</span>
<span class="sd">            coin: The coin to withdraw (e.g., &quot;USDT&quot;)</span>
<span class="sd">            withdraw_address: The destination withdrawal address</span>
<span class="sd">            quantity: Amount to withdraw (must not exceed maximalWithdraw)</span>
<span class="sd">            max_fees: Maximum fees allowed for the withdrawal</span>
<span class="sd">            network: The blockchain network to withdraw on (default: &quot;arbitrum&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            WithdrawResponse: Response containing the withdrawal order ID</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            POST /capital/withdraw</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create withdraw request payload</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">WithdrawRequest</span><span class="p">(</span>
            <span class="n">accountId</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">account_id</span><span class="p">,</span>
            <span class="n">coin</span><span class="o">=</span><span class="n">coin</span><span class="p">,</span>
            <span class="n">withdrawAddress</span><span class="o">=</span><span class="n">withdraw_address</span><span class="p">,</span>
            <span class="n">network</span><span class="o">=</span><span class="n">network</span><span class="p">,</span>
            <span class="n">quantity</span><span class="o">=</span><span class="n">quantity</span><span class="p">,</span>
            <span class="n">maxFees</span><span class="o">=</span><span class="n">max_fees</span><span class="p">,</span>
            <span class="n">signature</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__sign_withdraw_payload</span><span class="p">(</span>
                <span class="n">coin</span><span class="p">,</span> <span class="n">withdraw_address</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">max_fees</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_authorized_request</span><span class="p">(</span>
            <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;/capital/withdraw&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">asdict</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">create_with</span><span class="p">(</span><span class="n">WithdrawResponse</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="HibachiApiClient.transfer">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.transfer">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">transfer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">coin</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">quantity</span><span class="p">:</span> <span class="n">HibachiNumericInput</span><span class="p">,</span>
        <span class="n">dstPublicKey</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">max_fees</span><span class="p">:</span> <span class="n">HibachiNumericInput</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransferResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Request fund transfer to another account.</span>

<span class="sd">        Transfers funds from your account to another account identified by its public key.</span>

<span class="sd">        Args:</span>
<span class="sd">            coin: The coin to transfer (e.g., &quot;USDT&quot;)</span>
<span class="sd">            quantity: The amount to transfer</span>
<span class="sd">            dstPublicKey: Destination account&#39;s public key</span>
<span class="sd">            max_fees: Maximum fees as a percentage</span>

<span class="sd">        Returns:</span>
<span class="sd">            TransferResponse: Response containing the transfer details</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            POST /capital/transfer</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nonce</span> <span class="o">=</span> <span class="n">time_ns</span><span class="p">()</span> <span class="o">//</span> <span class="mi">1_000</span>

        <span class="n">request</span> <span class="o">=</span> <span class="n">TransferRequest</span><span class="p">(</span>
            <span class="n">accountId</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">account_id</span><span class="p">,</span>
            <span class="n">coin</span><span class="o">=</span><span class="n">coin</span><span class="p">,</span>
            <span class="n">nonce</span><span class="o">=</span><span class="n">nonce</span><span class="p">,</span>
            <span class="n">dstPublicKey</span><span class="o">=</span><span class="n">dstPublicKey</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;0x&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="n">fees</span><span class="o">=</span><span class="n">max_fees</span><span class="p">,</span>
            <span class="n">quantity</span><span class="o">=</span><span class="n">quantity</span><span class="p">,</span>
            <span class="n">signature</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__sign_transfer_payload</span><span class="p">(</span>
                <span class="n">nonce</span><span class="p">,</span> <span class="n">coin</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">dstPublicKey</span><span class="p">,</span> <span class="n">max_fees</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_authorized_request</span><span class="p">(</span>
            <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;/capital/transfer&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">asdict</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">create_with</span><span class="p">(</span><span class="n">TransferResponse</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="HibachiApiClient.get_deposit_info">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.get_deposit_info">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_deposit_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">public_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DepositInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get deposit address information for a public key.</span>

<span class="sd">        Retrieves the EVM deposit address associated with the specified public key.</span>

<span class="sd">        Args:</span>
<span class="sd">            public_key: The public key to get deposit info for</span>

<span class="sd">        Returns:</span>
<span class="sd">            DepositInfo: Deposit address information containing the EVM deposit address</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            GET /capital/deposit-info</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_authorized_request</span><span class="p">(</span>
            <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;/capital/deposit-info?accountId=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">account_id</span><span class="si">}</span><span class="s2">&amp;publicKey=</span><span class="si">{</span><span class="n">public_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">create_with</span><span class="p">(</span><span class="n">DepositInfo</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">return</span> <span class="n">result</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">__sign_withdraw_payload</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">coin</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">withdraw_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_fees</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sign a withdrawal request payload.</span>

<span class="sd">        Creates a binary payload from withdrawal parameters and signs it using</span>
<span class="sd">        the configured private key.</span>

<span class="sd">        Args:</span>
<span class="sd">            coin: The coin to withdraw (e.g., &quot;USDT&quot;)</span>
<span class="sd">            withdraw_address: The destination withdrawal address</span>
<span class="sd">            quantity: The withdrawal amount</span>
<span class="sd">            max_fees: Maximum fees allowed</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The hex-encoded signature for the withdrawal request</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">asset_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_asset_id</span><span class="p">(</span><span class="n">coin</span><span class="p">)</span>
        <span class="c1"># Create payload bytes</span>
        <span class="n">asset_id_bytes</span> <span class="o">=</span> <span class="n">asset_id</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span>
        <span class="n">quantity_bytes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span>
            <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span>
        <span class="p">)</span>  <span class="c1"># Assuming 6 decimals for USDT</span>
        <span class="n">max_fees_bytes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">max_fees</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span>
            <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span>
        <span class="p">)</span>  <span class="c1"># Assuming 6 decimals for USDT</span>
        <span class="n">address_bytes</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">withdraw_address</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;0x&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

        <span class="c1"># Combine payload</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">asset_id_bytes</span> <span class="o">+</span> <span class="n">quantity_bytes</span> <span class="o">+</span> <span class="n">max_fees_bytes</span> <span class="o">+</span> <span class="n">address_bytes</span>

        <span class="c1"># Sign payload</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sign_payload</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__sign_transfer_payload</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nonce</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">coin</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">quantity</span><span class="p">:</span> <span class="n">HibachiNumericInput</span><span class="p">,</span>
        <span class="n">dst_account_public_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">max_fees_percent</span><span class="p">:</span> <span class="n">HibachiNumericInput</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create and sign the payload for a transfer request.</span>

<span class="sd">        Args:</span>
<span class="sd">            nonce: Unique nonce for this transfer (defaults to current epoch timestamp in s)</span>
<span class="sd">            coin: The coin to transfer (e.g., &quot;USDT&quot;)</span>
<span class="sd">            quantity: The amount to transfer</span>
<span class="sd">            dst_account_public_key: Destination account&#39;s public key</span>
<span class="sd">            max_fees_percent: Maximum fees as a percentage</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The hex-encoded signature</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">quantity</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>
        <span class="n">max_fees_percent</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">max_fees_percent</span><span class="p">)</span>
        <span class="n">asset_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_asset_id</span><span class="p">(</span><span class="n">coin</span><span class="p">)</span>
        <span class="c1"># Create payload bytes</span>
        <span class="n">nonce_bytes</span> <span class="o">=</span> <span class="n">nonce</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span>
        <span class="n">asset_id_bytes</span> <span class="o">=</span> <span class="n">asset_id</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span>
        <span class="n">quantity_bytes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span>
            <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span>
        <span class="p">)</span>  <span class="c1"># Assuming 6 decimals for USDT</span>
        <span class="n">max_fees_bytes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">max_fees_percent</span><span class="p">))</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span>
        <span class="n">address_bytes</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">dst_account_public_key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;0x&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

        <span class="c1"># Combine payload</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">nonce_bytes</span>
            <span class="o">+</span> <span class="n">asset_id_bytes</span>
            <span class="o">+</span> <span class="n">quantity_bytes</span>
            <span class="o">+</span> <span class="n">address_bytes</span>
            <span class="o">+</span> <span class="n">max_fees_bytes</span>
        <span class="p">)</span>

        <span class="c1"># Sign payload</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sign_payload</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

    <span class="c1">############################################################################</span>
    <span class="c1">## Trade API endpoints, account_id and api_key must be set</span>

<div class="viewcode-block" id="HibachiApiClient.get_account_info">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.get_account_info">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_account_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AccountInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get detailed account information.</span>

<span class="sd">        Retrieves comprehensive account information including balance, positions,</span>
<span class="sd">        assets, fee rates, and withdrawal limits.</span>

<span class="sd">        Returns:</span>
<span class="sd">            AccountInfo: Account details including balance, positions, assets,</span>
<span class="sd">                order notional, unrealized PnL, and fee rates</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>

<span class="sd">        Example:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                account_info = client.get_account_info()</span>
<span class="sd">                print(account_info.balance)</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            GET /trade/account/info</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_authorized_request</span><span class="p">(</span>
            <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/trade/account/info?accountId=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">account_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">assets</span> <span class="o">=</span> <span class="p">[</span><span class="n">create_with</span><span class="p">(</span><span class="n">Asset</span><span class="p">,</span> <span class="n">asset</span><span class="p">)</span> <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]]</span>  <span class="c1"># type: ignore</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">create_with</span><span class="p">(</span><span class="n">Position</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
                <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="p">]</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">AccountInfo</span><span class="p">(</span>
                <span class="n">assets</span><span class="o">=</span><span class="n">assets</span><span class="p">,</span>
                <span class="n">balance</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;balance&quot;</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
                <span class="n">maximalWithdraw</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;maximalWithdraw&quot;</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
                <span class="n">numFreeTransfersRemaining</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;numFreeTransfersRemaining&quot;</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
                <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span>
                <span class="n">totalOrderNotional</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;totalOrderNotional&quot;</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
                <span class="n">totalPositionNotional</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;totalPositionNotional&quot;</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
                <span class="n">totalUnrealizedFundingPnl</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;totalUnrealizedFundingPnl&quot;</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
                <span class="n">totalUnrealizedPnl</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;totalUnrealizedPnl&quot;</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
                <span class="n">totalUnrealizedTradingPnl</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;totalUnrealizedTradingPnl&quot;</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
                <span class="n">tradeMakerFeeRate</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;tradeMakerFeeRate&quot;</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
                <span class="n">tradeTakerFeeRate</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;tradeTakerFeeRate&quot;</span><span class="p">],</span>  <span class="c1"># type: ignore</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="HibachiApiClient.get_account_trades">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.get_account_trades">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_account_trades</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AccountTradesResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get account trade history.</span>

<span class="sd">        Retrieves the most recent trade history for your account, up to 100 records.</span>

<span class="sd">        Returns:</span>
<span class="sd">            AccountTradesResponse: List of recent trades with details including price,</span>
<span class="sd">                quantity, side, fees, realized PnL, and timestamps</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>

<span class="sd">        Example:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                account_trades = client.get_account_trades()</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            GET /trade/account/trades</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_authorized_request</span><span class="p">(</span>
            <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/trade/account/trades?accountId=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">account_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">trades</span> <span class="o">=</span> <span class="p">[</span><span class="n">create_with</span><span class="p">(</span><span class="n">AccountTrade</span><span class="p">,</span> <span class="n">trade</span><span class="p">)</span> <span class="k">for</span> <span class="n">trade</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;trades&quot;</span><span class="p">]]</span>  <span class="c1"># type: ignore</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">AccountTradesResponse</span><span class="p">(</span><span class="n">trades</span><span class="o">=</span><span class="n">trades</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="HibachiApiClient.get_settlements_history">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.get_settlements_history">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_settlements_history</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SettlementsResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get settlement history for your account.</span>

<span class="sd">        Retrieves the history of settled trades, including position settlements</span>
<span class="sd">        and funding rate settlements.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SettlementsResponse: List of settlements with direction, price, quantity,</span>
<span class="sd">                settled amount, symbol, and timestamp</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>

<span class="sd">        Example:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                settlements = client.get_settlements_history()</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            GET /trade/account/settlements_history</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_authorized_request</span><span class="p">(</span>
            <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/trade/account/settlements_history?accountId=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">account_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">settlements</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">create_with</span><span class="p">(</span><span class="n">Settlement</span><span class="p">,</span> <span class="n">settlement</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
                <span class="k">for</span> <span class="n">settlement</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;settlements&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">SettlementsResponse</span><span class="p">(</span><span class="n">settlements</span><span class="o">=</span><span class="n">settlements</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="HibachiApiClient.get_pending_orders">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.get_pending_orders">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_pending_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PendingOrdersResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all pending orders for your account.</span>

<span class="sd">        Retrieves all currently active orders including open, partially filled,</span>
<span class="sd">        and triggered orders.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PendingOrdersResponse: List of pending orders with details including order ID,</span>
<span class="sd">                type, side, price, quantity, status, and timestamps</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>

<span class="sd">        Example:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                pending_orders = client.get_pending_orders()</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            GET /trade/orders</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_authorized_request</span><span class="p">(</span>
            <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/trade/orders?accountId=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">account_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">orders</span> <span class="o">=</span> <span class="p">[</span><span class="n">create_with</span><span class="p">(</span><span class="n">Order</span><span class="p">,</span> <span class="n">order_data</span><span class="p">)</span> <span class="k">for</span> <span class="n">order_data</span> <span class="ow">in</span> <span class="n">response</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">PendingOrdersResponse</span><span class="p">(</span><span class="n">orders</span><span class="o">=</span><span class="n">orders</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="HibachiApiClient.get_order_details">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.get_order_details">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_order_details</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nonce</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get detailed information for a specific order.</span>

<span class="sd">        Retrieves order details using either the order ID or the nonce used when</span>
<span class="sd">        creating the order. At least one identifier must be provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            order_id: The order ID to query (optional)</span>
<span class="sd">            nonce: The nonce used when creating the order (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Order: Order details including ID, type, side, price, quantity, status,</span>
<span class="sd">                and timestamps</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If neither order_id nor nonce is provided</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>

<span class="sd">        Example:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                order_details = client.get_order_details(order_id=123)</span>
<span class="sd">                # or</span>
<span class="sd">                order_details = client.get_order_details(nonce=1234567)</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            GET /trade/order</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_order_selector</span><span class="p">(</span><span class="n">order_id</span><span class="p">,</span> <span class="n">nonce</span><span class="p">)</span>

        <span class="n">order_selector</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;orderId=</span><span class="si">{</span><span class="n">order_id</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">order_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;nonce=</span><span class="si">{</span><span class="n">nonce</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_authorized_request</span><span class="p">(</span>
            <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/trade/order?accountId=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">account_id</span><span class="si">}</span><span class="s2">&amp;</span><span class="si">{</span><span class="n">order_selector</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">create_with</span><span class="p">(</span><span class="n">Order</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">implicit_null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="k">return</span> <span class="n">result</span></div>


    <span class="c1"># Order API endpoints require the private key to be set</span>

<div class="viewcode-block" id="HibachiApiClient.place_market_order">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.place_market_order">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">place_market_order</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">quantity</span><span class="p">:</span> <span class="n">HibachiNumericInput</span><span class="p">,</span>
        <span class="n">side</span><span class="p">:</span> <span class="n">Side</span><span class="p">,</span>
        <span class="n">max_fees_percent</span><span class="p">:</span> <span class="n">HibachiNumericInput</span><span class="p">,</span>
        <span class="n">trigger_price</span><span class="p">:</span> <span class="n">HibachiNumericInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">twap_config</span><span class="p">:</span> <span class="n">TWAPConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">creation_deadline</span><span class="p">:</span> <span class="n">HibachiNumericInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">order_flags</span><span class="p">:</span> <span class="n">OrderFlags</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tpsl</span><span class="p">:</span> <span class="n">TPSLConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Nonce</span><span class="p">,</span> <span class="n">OrderId</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Place a market order.</span>

<span class="sd">        Submits a market order that executes immediately at the current market price.</span>
<span class="sd">        Supports trigger prices, TWAP execution, and take-profit/stop-loss configurations.</span>

<span class="sd">        Args:</span>
<span class="sd">            symbol: The trading symbol (e.g., &quot;BTC/USDT-P&quot;)</span>
<span class="sd">            quantity: The order quantity</span>
<span class="sd">            side: Order side (BUY, SELL, BID, or ASK)</span>
<span class="sd">            max_fees_percent: Maximum fees as a percentage</span>
<span class="sd">            trigger_price: Price to trigger order execution (optional)</span>
<span class="sd">            twap_config: Time-weighted average price configuration (optional)</span>
<span class="sd">            creation_deadline: Deadline in seconds for order creation (optional)</span>
<span class="sd">            order_flags: Additional order flags (optional)</span>
<span class="sd">            tpsl: Take-profit/stop-loss configuration (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[Nonce, OrderId]: Tuple containing the nonce (defaults to current epoch timestamp in s) and order ID</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If both twap_config and trigger_price are set, or if twap_config and tpsl are set</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>

<span class="sd">        Example:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                (nonce, order_id) = client.place_market_order(&quot;BTC/USDT-P&quot;, 0.0001, Side.BUY, max_fees_percent)</span>
<span class="sd">                (nonce, order_id) = client.place_market_order(&quot;BTC/USDT-P&quot;, 0.0001, Side.SELL, max_fees_percent)</span>
<span class="sd">                (nonce, order_id) = client.place_market_order(&quot;BTC/USDT-P&quot;, 0.0001, Side.BID, max_fees_percent, creation_deadline=2)</span>
<span class="sd">                (nonce, order_id) = client.place_market_order(&quot;BTC/USDT-P&quot;, 0.0001, Side.ASK, max_fees_percent, trigger_price=1_000_000)</span>
<span class="sd">                (nonce, order_id) = client.place_market_order(&quot;SOL/USDT-P&quot;, 1, Side.BID, max_fees_percent, twap_config=twap_config)</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            POST /trade/order</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ensure_contract_listed</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="n">Side</span><span class="o">.</span><span class="n">BUY</span><span class="p">:</span>
            <span class="n">side</span> <span class="o">=</span> <span class="n">Side</span><span class="o">.</span><span class="n">BID</span>
        <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="n">Side</span><span class="o">.</span><span class="n">SELL</span><span class="p">:</span>
            <span class="n">side</span> <span class="o">=</span> <span class="n">Side</span><span class="o">.</span><span class="n">ASK</span>

        <span class="k">if</span> <span class="n">twap_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">trigger_price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can not set trigger price for TWAP order&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">twap_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">tpsl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can not set tpsl for TWAP order&quot;</span><span class="p">)</span>

        <span class="n">quantity</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>
        <span class="n">max_fees_percent</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">max_fees_percent</span><span class="p">)</span>
        <span class="n">trigger_price</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">trigger_price</span><span class="p">)</span>
        <span class="n">creation_deadline</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">creation_deadline</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tpsl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tpsl</span><span class="o">.</span><span class="n">legs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_place_parent_with_tpsl</span><span class="p">(</span>
                <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
                <span class="n">price</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">quantity</span><span class="o">=</span><span class="n">quantity</span><span class="p">,</span>
                <span class="n">side</span><span class="o">=</span><span class="n">side</span><span class="p">,</span>
                <span class="n">max_fees_percent</span><span class="o">=</span><span class="n">max_fees_percent</span><span class="p">,</span>
                <span class="n">trigger_price</span><span class="o">=</span><span class="n">trigger_price</span><span class="p">,</span>
                <span class="n">creation_deadline</span><span class="o">=</span><span class="n">creation_deadline</span><span class="p">,</span>
                <span class="n">order_flags</span><span class="o">=</span><span class="n">order_flags</span><span class="p">,</span>
                <span class="n">tpsl</span><span class="o">=</span><span class="n">tpsl</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">nonce</span> <span class="o">=</span> <span class="n">time_ns</span><span class="p">()</span> <span class="o">//</span> <span class="mi">1_000</span>
        <span class="n">request_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_order_request_data</span><span class="p">(</span>
            <span class="n">nonce</span><span class="p">,</span>
            <span class="n">symbol</span><span class="p">,</span>
            <span class="n">quantity</span><span class="p">,</span>
            <span class="n">side</span><span class="p">,</span>
            <span class="n">max_fees_percent</span><span class="p">,</span>
            <span class="n">trigger_price</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">creation_deadline</span><span class="p">,</span>
            <span class="n">twap_config</span><span class="o">=</span><span class="n">twap_config</span><span class="p">,</span>
            <span class="n">order_flags</span><span class="o">=</span><span class="n">order_flags</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;accountId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_id</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_authorized_request</span><span class="p">(</span>
            <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;/trade/order&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">request_data</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">order_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;orderId&quot;</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">nonce</span><span class="p">,</span> <span class="n">order_id</span><span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span></div>


<div class="viewcode-block" id="HibachiApiClient.place_limit_order">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.place_limit_order">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">place_limit_order</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">quantity</span><span class="p">:</span> <span class="n">HibachiNumericInput</span><span class="p">,</span>
        <span class="n">price</span><span class="p">:</span> <span class="n">HibachiNumericInput</span><span class="p">,</span>
        <span class="n">side</span><span class="p">:</span> <span class="n">Side</span><span class="p">,</span>
        <span class="n">max_fees_percent</span><span class="p">:</span> <span class="n">HibachiNumericInput</span><span class="p">,</span>
        <span class="n">trigger_price</span><span class="p">:</span> <span class="n">HibachiNumericInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">creation_deadline</span><span class="p">:</span> <span class="n">HibachiNumericInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">order_flags</span><span class="p">:</span> <span class="n">OrderFlags</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tpsl</span><span class="p">:</span> <span class="n">TPSLConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Nonce</span><span class="p">,</span> <span class="n">OrderId</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Place a limit order.</span>

<span class="sd">        Submits a limit order that executes only at the specified price or better.</span>
<span class="sd">        Supports trigger prices and take-profit/stop-loss configurations.</span>

<span class="sd">        Args:</span>
<span class="sd">            symbol: The trading symbol (e.g., &quot;BTC/USDT-P&quot;)</span>
<span class="sd">            quantity: The order quantity</span>
<span class="sd">            price: The limit price</span>
<span class="sd">            side: Order side (BUY, SELL, BID, or ASK)</span>
<span class="sd">            max_fees_percent: Maximum fees as a percentage</span>
<span class="sd">            trigger_price: Price to trigger order execution (optional)</span>
<span class="sd">            creation_deadline: Deadline in seconds for order creation (optional)</span>
<span class="sd">            order_flags: Additional order flags (optional)</span>
<span class="sd">            tpsl: Take-profit/stop-loss configuration (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[Nonce, OrderId]: Tuple containing the nonce (defaults to current epoch timestamp in s) and order ID</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>

<span class="sd">        Example:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                (nonce, order_id) = client.place_limit_order(&quot;BTC/USDT-P&quot;, 0.0001, 80_000, Side.BUY, max_fees_percent)</span>
<span class="sd">                (nonce, order_id) = client.place_limit_order(&quot;BTC/USDT-P&quot;, 0.0001, 80_000, Side.SELL, max_fees_percent)</span>
<span class="sd">                (nonce, order_id) = client.place_limit_order(&quot;BTC/USDT-P&quot;, 0.0001, 80_000, Side.BID, max_fees_percent, creation_deadline=2)</span>
<span class="sd">                (nonce, order_id) = client.place_limit_order(&quot;BTC/USDT-P&quot;, 0.0001, 1_001_000, Side.ASK, max_fees_percent, trigger_price=1_000_000)</span>
<span class="sd">                (nonce, limit_order_id) = client.place_limit_order(&quot;BTC/USDT-P&quot;, 0.001, 6_000, Side.BID, max_fees_percent)</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            POST /trade/order</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ensure_contract_listed</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="n">Side</span><span class="o">.</span><span class="n">BUY</span><span class="p">:</span>
            <span class="n">side</span> <span class="o">=</span> <span class="n">Side</span><span class="o">.</span><span class="n">BID</span>
        <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="n">Side</span><span class="o">.</span><span class="n">SELL</span><span class="p">:</span>
            <span class="n">side</span> <span class="o">=</span> <span class="n">Side</span><span class="o">.</span><span class="n">ASK</span>

        <span class="n">price</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
        <span class="n">quantity</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>
        <span class="n">max_fees_percent</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">max_fees_percent</span><span class="p">)</span>
        <span class="n">trigger_price</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">trigger_price</span><span class="p">)</span>
        <span class="n">creation_deadline</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">creation_deadline</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tpsl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tpsl</span><span class="o">.</span><span class="n">legs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_place_parent_with_tpsl</span><span class="p">(</span>
                <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
                <span class="n">price</span><span class="o">=</span><span class="n">price</span><span class="p">,</span>
                <span class="n">quantity</span><span class="o">=</span><span class="n">quantity</span><span class="p">,</span>
                <span class="n">side</span><span class="o">=</span><span class="n">side</span><span class="p">,</span>
                <span class="n">max_fees_percent</span><span class="o">=</span><span class="n">max_fees_percent</span><span class="p">,</span>
                <span class="n">trigger_price</span><span class="o">=</span><span class="n">trigger_price</span><span class="p">,</span>
                <span class="n">creation_deadline</span><span class="o">=</span><span class="n">creation_deadline</span><span class="p">,</span>
                <span class="n">order_flags</span><span class="o">=</span><span class="n">order_flags</span><span class="p">,</span>
                <span class="n">tpsl</span><span class="o">=</span><span class="n">tpsl</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">nonce</span> <span class="o">=</span> <span class="n">time_ns</span><span class="p">()</span> <span class="o">//</span> <span class="mi">1_000</span>
        <span class="n">request_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_order_request_data</span><span class="p">(</span>
            <span class="n">nonce</span><span class="p">,</span>
            <span class="n">symbol</span><span class="p">,</span>
            <span class="n">quantity</span><span class="p">,</span>
            <span class="n">side</span><span class="p">,</span>
            <span class="n">max_fees_percent</span><span class="p">,</span>
            <span class="n">trigger_price</span><span class="p">,</span>
            <span class="n">price</span><span class="p">,</span>
            <span class="n">creation_deadline</span><span class="p">,</span>
            <span class="n">order_flags</span><span class="o">=</span><span class="n">order_flags</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;accountId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_id</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_authorized_request</span><span class="p">(</span>
            <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;/trade/order&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">request_data</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">order_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;orderId&quot;</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">nonce</span><span class="p">,</span> <span class="n">order_id</span><span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid </span><span class="si">{</span><span class="n">response</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_place_parent_with_tpsl</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">quantity</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">,</span>
        <span class="n">price</span><span class="p">:</span> <span class="n">Decimal</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">side</span><span class="p">:</span> <span class="n">Side</span><span class="p">,</span>
        <span class="n">max_fees_percent</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">,</span>
        <span class="n">tpsl</span><span class="p">:</span> <span class="n">TPSLConfig</span><span class="p">,</span>
        <span class="n">trigger_price</span><span class="p">:</span> <span class="n">Decimal</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">creation_deadline</span><span class="p">:</span> <span class="n">Decimal</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">order_flags</span><span class="p">:</span> <span class="n">OrderFlags</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Nonce</span><span class="p">,</span> <span class="n">OrderId</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Place a parent order with take-profit/stop-loss child orders.</span>

<span class="sd">        Creates a parent order along with its configured TP/SL child orders in a single batch.</span>

<span class="sd">        Args:</span>
<span class="sd">            symbol: Trading symbol</span>
<span class="sd">            quantity: Order quantity</span>
<span class="sd">            price: Limit price (None for market orders)</span>
<span class="sd">            side: Order side (BID/ASK)</span>
<span class="sd">            max_fees_percent: Maximum fees as percentage</span>
<span class="sd">            tpsl: Take-profit/stop-loss configuration</span>
<span class="sd">            trigger_price: Trigger price for parent order (optional)</span>
<span class="sd">            creation_deadline: Deadline for order creation (optional)</span>
<span class="sd">            order_flags: Additional order flags (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[Nonce, OrderId]: The nonce (defaults to current epoch timestamp in s) and order ID of the parent order</span>

<span class="sd">        Raises:</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO double conversion</span>
        <span class="n">parent_order_request</span> <span class="o">=</span> <span class="n">CreateOrder</span><span class="p">(</span>
            <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
            <span class="n">quantity</span><span class="o">=</span><span class="n">quantity</span><span class="p">,</span>
            <span class="n">side</span><span class="o">=</span><span class="n">side</span><span class="p">,</span>
            <span class="n">price</span><span class="o">=</span><span class="n">price</span><span class="p">,</span>
            <span class="n">trigger_price</span><span class="o">=</span><span class="n">trigger_price</span><span class="p">,</span>
            <span class="n">creation_deadline</span><span class="o">=</span><span class="n">creation_deadline</span><span class="p">,</span>
            <span class="n">order_flags</span><span class="o">=</span><span class="n">order_flags</span><span class="p">,</span>
            <span class="n">max_fees_percent</span><span class="o">=</span><span class="n">max_fees_percent</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">nonce</span> <span class="o">=</span> <span class="n">time_ns</span><span class="p">()</span> <span class="o">//</span> <span class="mi">1_000</span>

        <span class="n">orders</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">CreateOrder</span><span class="p">]</span> <span class="o">=</span> <span class="n">tpsl</span><span class="o">.</span><span class="n">_as_requests</span><span class="p">(</span>
            <span class="n">parent_symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
            <span class="n">parent_quantity</span><span class="o">=</span><span class="n">quantity</span><span class="p">,</span>
            <span class="n">parent_side</span><span class="o">=</span><span class="n">side</span><span class="p">,</span>
            <span class="n">parent_nonce</span><span class="o">=</span><span class="n">nonce</span><span class="p">,</span>
            <span class="n">max_fees_percent</span><span class="o">=</span><span class="n">max_fees_percent</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># prepend parent order request - this MUST be listed first</span>
        <span class="n">orders</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">parent_order_request</span><span class="p">)</span>

        <span class="n">orders_data</span><span class="p">:</span> <span class="n">JsonArray</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__batch_order_request_data</span><span class="p">(</span><span class="n">nonce</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">request_data</span><span class="p">:</span> <span class="n">JsonObject</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;accountId&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">account_id</span><span class="p">),</span>
            <span class="s2">&quot;orders&quot;</span><span class="p">:</span> <span class="n">orders_data</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_authorized_request</span><span class="p">(</span>
            <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;/trade/orders&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">request_data</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">orders</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">deserialize_batch_response_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
                <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;orders&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;orders&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">orders</span>  <span class="c1"># type: ignore</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">create_with</span><span class="p">(</span><span class="n">BatchResponse</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
            <span class="n">parent_order</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">orders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent_order</span><span class="p">,</span> <span class="n">CreateOrderBatchResponse</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">parent_order</span><span class="o">.</span><span class="n">nonce</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">parent_order</span><span class="o">.</span><span class="n">orderId</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent_order</span><span class="p">,</span> <span class="n">ErrorBatchResponse</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">parent_order</span><span class="o">.</span><span class="n">as_exception</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Received invalid response, </span><span class="si">{</span><span class="n">parent_order</span><span class="si">=}</span><span class="s2"> of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">parent_order</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">result</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

<div class="viewcode-block" id="HibachiApiClient.update_order">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.update_order">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_order</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">order_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">max_fees_percent</span><span class="p">:</span> <span class="n">HibachiNumericInput</span><span class="p">,</span>
        <span class="n">quantity</span><span class="p">:</span> <span class="n">HibachiNumericInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">price</span><span class="p">:</span> <span class="n">HibachiNumericInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">trigger_price</span><span class="p">:</span> <span class="n">HibachiNumericInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">creation_deadline</span><span class="p">:</span> <span class="n">HibachiNumericInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Json</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update an existing order.</span>

<span class="sd">        Modifies the parameters of an existing order including quantity, price,</span>
<span class="sd">        and trigger price. The order is retrieved first to maintain unmodified fields.</span>

<span class="sd">        Args:</span>
<span class="sd">            order_id: The ID of the order to update</span>
<span class="sd">            max_fees_percent: Maximum fees as a percentage</span>
<span class="sd">            quantity: Updated order quantity (optional)</span>
<span class="sd">            price: Updated limit price (optional)</span>
<span class="sd">            trigger_price: Updated trigger price (optional)</span>
<span class="sd">            creation_deadline: Deadline in seconds for update (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Json: The API response</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If update parameters are invalid for the order type</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>

<span class="sd">        Example:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                max_fees_percent = 0.0005</span>
<span class="sd">                client.update_order(order_id, max_fees_percent, quantity=0.002)</span>
<span class="sd">                client.update_order(order_id, max_fees_percent, price=1_050_000)</span>
<span class="sd">                client.update_order(order_id, max_fees_percent, trigger_price=1_100_000)</span>
<span class="sd">                client.update_order(order_id, max_fees_percent, quantity=0.001, price=1_210_000, trigger_price=1_250_000)</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            PUT /trade/order</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_order_details</span><span class="p">(</span><span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">)</span>

        <span class="n">price</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
        <span class="n">trigger_price</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">trigger_price</span><span class="p">)</span>
        <span class="n">quantity</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>
        <span class="n">max_fees_percent</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">max_fees_percent</span><span class="p">)</span>

        <span class="n">request_data_two</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_order_generate_sig</span><span class="p">(</span>
            <span class="n">order</span><span class="p">,</span>
            <span class="n">price</span><span class="o">=</span><span class="n">price</span><span class="p">,</span>
            <span class="n">side</span><span class="o">=</span><span class="n">Side</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">side</span><span class="p">),</span>
            <span class="n">max_fees_percent</span><span class="o">=</span><span class="n">max_fees_percent</span><span class="p">,</span>
            <span class="n">trigger_price</span><span class="o">=</span><span class="n">trigger_price</span><span class="p">,</span>
            <span class="n">quantity</span><span class="o">=</span><span class="n">quantity</span><span class="p">,</span>
            <span class="n">creation_deadline</span><span class="o">=</span><span class="n">creation_deadline</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_authorized_request</span><span class="p">(</span>
            <span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="s2">&quot;/trade/order&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">request_data_two</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_update_order_generate_sig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">order</span><span class="p">:</span> <span class="n">Order</span><span class="p">,</span>
        <span class="n">side</span><span class="p">:</span> <span class="n">Side</span><span class="p">,</span>
        <span class="n">max_fees_percent</span><span class="p">:</span> <span class="n">HibachiNumericInput</span><span class="p">,</span>
        <span class="n">quantity</span><span class="p">:</span> <span class="n">HibachiNumericInput</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">price</span><span class="p">:</span> <span class="n">HibachiNumericInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">trigger_price</span><span class="p">:</span> <span class="n">HibachiNumericInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">creation_deadline</span><span class="p">:</span> <span class="n">HibachiNumericInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nonce</span><span class="p">:</span> <span class="n">Nonce</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate signature and request data for updating an order.</span>

<span class="sd">        Creates the signed request data needed to update an existing order. Infers</span>
<span class="sd">        missing fields from the existing order object.</span>

<span class="sd">        Args:</span>
<span class="sd">            order: The existing order to update</span>
<span class="sd">            side: Order side (BID or ASK)</span>
<span class="sd">            max_fees_percent: Maximum fees as a percentage</span>
<span class="sd">            quantity: Updated order quantity (optional)</span>
<span class="sd">            price: Updated limit price (optional)</span>
<span class="sd">            trigger_price: Updated trigger price (optional)</span>
<span class="sd">            creation_deadline: Deadline in seconds for update (optional)</span>
<span class="sd">            nonce: Custom nonce for the update (optional, defaults to current epoch timestamp in s)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Any]: The signed request data ready to send to the API</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If update parameters are invalid for the order type</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="n">symbol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ensure_contract_listed</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>

        <span class="c1"># Infer missing fields from order object</span>
        <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">orderType</span> <span class="o">==</span> <span class="n">OrderType</span><span class="o">.</span><span class="n">MARKET</span> <span class="ow">and</span> <span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span> <span class="kn">from</span><span class="w"> </span><span class="nn">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Can not update price for a market order&quot;</span>
            <span class="p">)</span>

        <span class="c1"># TODO these should raise, warn short term</span>
        <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">orderType</span> <span class="o">==</span> <span class="n">OrderType</span><span class="o">.</span><span class="n">LIMIT</span> <span class="ow">and</span> <span class="n">price</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">price</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">triggerPrice</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">trigger_price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span> <span class="kn">from</span><span class="w"> </span><span class="nn">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot update trigger price for a non trigger order&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">triggerPrice</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">trigger_price</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trigger_price</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="n">triggerPrice</span>

        <span class="k">if</span> <span class="n">quantity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">totalQuantity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span> <span class="kn">from</span><span class="w"> </span><span class="nn">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;one of `quantity` or `order.totalQuantity` must be defined&quot;</span>
                <span class="p">)</span>
            <span class="n">quantity</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="n">totalQuantity</span>

        <span class="n">price</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
        <span class="n">trigger_price</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">trigger_price</span><span class="p">)</span>
        <span class="n">quantity</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>
        <span class="n">max_fees_percent</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">max_fees_percent</span><span class="p">)</span>
        <span class="n">creation_deadline</span> <span class="o">=</span> <span class="n">numeric_to_decimal</span><span class="p">(</span><span class="n">creation_deadline</span><span class="p">)</span>

        <span class="n">side</span> <span class="o">=</span> <span class="n">Side</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">side</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="n">Side</span><span class="o">.</span><span class="n">BUY</span><span class="p">:</span>
            <span class="n">side</span> <span class="o">=</span> <span class="n">Side</span><span class="o">.</span><span class="n">BID</span>
        <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="n">Side</span><span class="o">.</span><span class="n">SELL</span><span class="p">:</span>
            <span class="n">side</span> <span class="o">=</span> <span class="n">Side</span><span class="o">.</span><span class="n">ASK</span>

        <span class="n">nonce</span> <span class="o">=</span> <span class="n">time_ns</span><span class="p">()</span> <span class="o">//</span> <span class="mi">1_000</span> <span class="k">if</span> <span class="n">nonce</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">nonce</span>
        <span class="n">request_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__update_order_request_data</span><span class="p">(</span>
            <span class="n">order_id</span><span class="o">=</span><span class="n">order</span><span class="o">.</span><span class="n">orderId</span><span class="p">,</span>
            <span class="n">nonce</span><span class="o">=</span><span class="n">nonce</span><span class="p">,</span>
            <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
            <span class="n">quantity</span><span class="o">=</span><span class="n">quantity</span><span class="p">,</span>
            <span class="n">side</span><span class="o">=</span><span class="n">side</span><span class="p">,</span>
            <span class="n">max_fees_percent</span><span class="o">=</span><span class="n">max_fees_percent</span><span class="p">,</span>
            <span class="n">price</span><span class="o">=</span><span class="n">price</span><span class="p">,</span>
            <span class="n">trigger_price</span><span class="o">=</span><span class="n">trigger_price</span><span class="p">,</span>
            <span class="n">creation_deadline</span><span class="o">=</span><span class="n">creation_deadline</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;accountId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_id</span>
        <span class="k">return</span> <span class="n">request_data</span>

<div class="viewcode-block" id="HibachiApiClient.cancel_order">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.cancel_order">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cancel_order</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nonce</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Json</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cancel an existing order.</span>

<span class="sd">        Cancels an order using either the order ID or the nonce used when creating</span>
<span class="sd">        the order. At least one identifier must be provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            order_id: The order ID to cancel (optional)</span>
<span class="sd">            nonce: The nonce used when creating the order (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Json: The API response</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If neither order_id nor nonce is provided</span>

<span class="sd">        Example:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                client.cancel_order(order_id=123)</span>
<span class="sd">                client.cancel_order(nonce=1234567)</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            DELETE /trade/order</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_order_selector</span><span class="p">(</span><span class="n">order_id</span><span class="p">,</span> <span class="n">nonce</span><span class="p">)</span>

        <span class="n">request_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_order_request_data</span><span class="p">(</span>
            <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
            <span class="n">nonce</span><span class="o">=</span><span class="n">nonce</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;accountId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">account_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_authorized_request</span><span class="p">(</span>
            <span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="s2">&quot;/trade/order&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">request_data</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="HibachiApiClient.cancel_all_orders">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.cancel_all_orders">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cancel_all_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contractId</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Json</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cancel all pending orders.</span>

<span class="sd">        Cancels all currently pending orders for the account. Currently uses a</span>
<span class="sd">        workaround that individually cancels each order.</span>

<span class="sd">        Args:</span>
<span class="sd">            contractId: Contract ID to filter orders (optional, currently unused)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Json: The API response (empty dict when using workaround)</span>

<span class="sd">        Example:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                client.cancel_all_orders()</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            DELETE /trade/orders</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO remove this</span>
        <span class="n">workaround</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">workaround</span><span class="p">:</span>
            <span class="n">orders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pending_orders</span><span class="p">()</span><span class="o">.</span><span class="n">orders</span>
            <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">orders</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cancel_order</span><span class="p">(</span><span class="n">order_id</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">orderId</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nonce</span> <span class="o">=</span> <span class="n">time_ns</span><span class="p">()</span> <span class="o">//</span> <span class="mi">1_000</span>
            <span class="n">request_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_order_request_data</span><span class="p">(</span><span class="n">order_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="n">nonce</span><span class="p">)</span>
            <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;accountId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">account_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_authorized_request</span><span class="p">(</span>
                <span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="s2">&quot;/trade/orders&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">request_data</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="HibachiApiClient.batch_orders">
<a class="viewcode-back" href="../../hibachi_xyz.html#hibachi_xyz.api.HibachiApiClient.batch_orders">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">batch_orders</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">orders</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">CreateOrder</span> <span class="o">|</span> <span class="n">UpdateOrder</span> <span class="o">|</span> <span class="n">CancelOrder</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BatchResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Submit multiple order operations in a single batch request.</span>

<span class="sd">        Creates, updates, and cancels orders atomically in a single API call.</span>
<span class="sd">        All order details must be provided explicitly (no shortcuts for updates).</span>

<span class="sd">        Args:</span>
<span class="sd">            orders: List of order operations (CreateOrder, UpdateOrder, or CancelOrder)</span>

<span class="sd">        Returns:</span>
<span class="sd">            BatchResponse: Response containing results for each order operation</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If an order operation is invalid</span>
<span class="sd">            DeserializationError: If the API response cannot be parsed</span>

<span class="sd">        Example::</span>

<span class="sd">            response = client.batch_orders([</span>
<span class="sd">                # Simple market order</span>
<span class="sd">                CreateOrder(&quot;BTC/USDT-P&quot;, Side.SELL, 0.001, max_fees_percent),</span>
<span class="sd">                # Simple limit order</span>
<span class="sd">                CreateOrder(&quot;BTC/USDT-P&quot;, Side.SELL, 0.001, max_fees_percent, price=90_000),</span>
<span class="sd">                # Trigger market order</span>
<span class="sd">                CreateOrder(&quot;BTC/USDT-P&quot;, Side.SELL, 0.001, max_fees_percent, trigger_price=85_000),</span>
<span class="sd">                # Trigger limit order</span>
<span class="sd">                CreateOrder(&quot;BTC/USDT-P&quot;, Side.SELL, 0.001, max_fees_percent, price=84_750, trigger_price=85_000),</span>
<span class="sd">                # TWAP order</span>
<span class="sd">                CreateOrder(&quot;BTC/USDT-P&quot;, Side.SELL, 0.001, max_fees_percent, twap_config=TWAPConfig(5, TWAPQuantityMode.FIXED)),</span>
<span class="sd">                # Update limit order (need all relevant optional parameters)</span>
<span class="sd">                UpdateOrder(limit_order_id, &quot;BTC/USDT-P&quot;, Side.BUY, 0.001, max_fees_percent, price=60_000),</span>
<span class="sd">                # Cancel order</span>
<span class="sd">                CancelOrder(order_id=limit_order_id),</span>
<span class="sd">            ])</span>

<span class="sd">        Endpoint:</span>
<span class="sd">            POST /trade/orders</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nonce</span> <span class="o">=</span> <span class="n">time_ns</span><span class="p">()</span> <span class="o">//</span> <span class="mi">1_000</span>
        <span class="n">orders_data</span><span class="p">:</span> <span class="n">JsonArray</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__batch_order_request_data</span><span class="p">(</span><span class="n">nonce</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">request_data</span><span class="p">:</span> <span class="n">JsonObject</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;accountId&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">account_id</span><span class="p">),</span>
            <span class="s2">&quot;orders&quot;</span><span class="p">:</span> <span class="n">orders_data</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__send_authorized_request</span><span class="p">(</span>
            <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;/trade/orders&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">request_data</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">orders</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">deserialize_batch_response_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
                <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;orders&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;orders&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">orders</span>  <span class="c1"># type: ignore</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">create_with</span><span class="p">(</span><span class="n">BatchResponse</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid response </span><span class="si">{</span><span class="n">result</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">return</span> <span class="n">response</span></div>


<span class="w">    </span><span class="sd">&quot;&quot;&quot; Deferred helpers &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__send_simple_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Json</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Send an unauthenticated request to the API.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: The API endpoint path</span>

<span class="sd">        Returns:</span>
<span class="sd">            Json: The parsed JSON response body</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_executor</span><span class="o">.</span><span class="n">send_simple_request</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">body</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__send_authorized_request</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">json</span><span class="p">:</span> <span class="n">Json</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Json</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Send an authenticated request to the API.</span>

<span class="sd">        Args:</span>
<span class="sd">            method: HTTP method (GET, POST, PUT, DELETE)</span>
<span class="sd">            path: The API endpoint path</span>
<span class="sd">            json: Optional JSON payload for the request body</span>

<span class="sd">        Returns:</span>
<span class="sd">            Json: The parsed JSON response body</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_executor</span><span class="o">.</span><span class="n">send_authorized_request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="p">)</span><span class="o">.</span><span class="n">body</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; Private helpers &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__get_asset_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coin</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the asset ID for a coin symbol.</span>

<span class="sd">        Args:</span>
<span class="sd">            coin: The coin symbol (e.g., &quot;USDT&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The asset ID</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If the coin is not recognized by the exchange</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_future_contracts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_exchange_info</span><span class="p">()</span>

        <span class="c1"># Find asset ID for the coin</span>
        <span class="n">asset_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">contract</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">future_contracts</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">contract</span><span class="o">.</span><span class="n">settlementSymbol</span> <span class="o">==</span> <span class="n">coin</span><span class="p">:</span>
                <span class="n">asset_id</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">id</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">asset_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">known_coins</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span>
                    <span class="n">contract</span><span class="o">.</span><span class="n">settlementSymbol</span>
                    <span class="k">for</span> <span class="n">contract</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">future_contracts</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">known_coins</span><span class="p">:</span>
                <span class="n">known_coins</span> <span class="o">=</span> <span class="s2">&quot;&lt;none&gt;&quot;</span>
            <span class="k">raise</span> <span class="n">ValidationError</span> <span class="kn">from</span><span class="w"> </span><span class="nn">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">coin</span><span class="si">=}</span><span class="s2"> not recognized by exchange. Known coins: </span><span class="si">{</span><span class="n">known_coins</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">asset_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__get_contract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FutureContract</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the future contract metadata for a trading symbol.</span>

<span class="sd">        Args:</span>
<span class="sd">            symbol: The trading symbol (e.g., &quot;BTC/USDT-P&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            FutureContract: The contract metadata</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If the symbol is not recognized by the exchange</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_future_contracts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_exchange_info</span><span class="p">()</span>

        <span class="n">contract</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">future_contracts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">contract</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">known_symbols</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">future_contracts</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">known_symbols</span><span class="p">:</span>
                <span class="n">known_symbols</span> <span class="o">=</span> <span class="s2">&quot;&lt;none&gt;&quot;</span>
            <span class="k">raise</span> <span class="n">ValidationError</span> <span class="kn">from</span><span class="w"> </span><span class="nn">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">symbol</span><span class="si">=}</span><span class="s2"> not recognized by exchange. Known symbols: </span><span class="si">{</span><span class="n">known_symbols</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">contract</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__ensure_contract_listed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that a trading symbol is listed on the exchange.</span>

<span class="sd">        Args:</span>
<span class="sd">            symbol: The trading symbol to validate</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If the symbol is not recognized by the exchange</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__get_contract</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__check_order_selector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nonce</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that at least one order identifier is provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            order_id: The order ID (optional)</span>
<span class="sd">            nonce: The order nonce (optional)</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If neither order_id nor nonce is provided</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">order_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">nonce</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span> <span class="kn">from</span><span class="w"> </span><span class="nn">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Either order_id or nonce must be provided&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__sign_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sign a payload using the configured private key.</span>

<span class="sd">        Supports both ECDSA (for wallet accounts) and HMAC (for web accounts) signing.</span>

<span class="sd">        Args:</span>
<span class="sd">            payload: The bytes to sign</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The hex-encoded signature</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If no private key is configured</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_private_key</span><span class="p">:</span>
            <span class="c1"># Hash the payload</span>
            <span class="n">message_hash</span> <span class="o">=</span> <span class="n">sha256</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>

            <span class="c1"># Sign the hash</span>
            <span class="n">signed_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_private_key</span><span class="o">.</span><span class="n">sign_msg_hash</span><span class="p">(</span><span class="n">message_hash</span><span class="p">)</span>

            <span class="c1"># Extract signature components</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">signed_message</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">signed_message</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">signed_message</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span>

            <span class="c1"># Combine to form the signature</span>
            <span class="n">signature_hex</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">signature_hex</span>  <span class="c1"># type: ignore</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_private_key_hmac</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_private_key_hmac</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">payload</span><span class="p">,</span> <span class="n">sha256</span>
            <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Private key is not set&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__create_or_update_order_payload</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">contract</span><span class="p">:</span> <span class="n">FutureContract</span><span class="p">,</span>
        <span class="n">nonce</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">quantity</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">,</span>
        <span class="n">side</span><span class="p">:</span> <span class="n">Side</span><span class="p">,</span>
        <span class="n">max_fees_percent</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">,</span>
        <span class="n">price</span><span class="p">:</span> <span class="n">Decimal</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the binary payload for creating or updating an order.</span>

<span class="sd">        Args:</span>
<span class="sd">            contract: The future contract metadata</span>
<span class="sd">            nonce: The nonce for this order (defaults to current epoch timestamp in s)</span>
<span class="sd">            quantity: The order quantity</span>
<span class="sd">            side: The order side (BID or ASK)</span>
<span class="sd">            max_fees_percent: Maximum fees as a percentage</span>
<span class="sd">            price: The limit price (None for market orders)</span>

<span class="sd">        Returns:</span>
<span class="sd">            bytes: The binary payload to be signed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">contract_id</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">id</span>

        <span class="n">nonce_bytes</span> <span class="o">=</span> <span class="n">nonce</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span>
        <span class="n">contract_id_bytes</span> <span class="o">=</span> <span class="n">contract_id</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span>
        <span class="n">quantity_bytes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">quantity</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">underlyingDecimals</span><span class="p">))</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span>
            <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span>
        <span class="p">)</span>
        <span class="n">price_bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">price</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">price_to_bytes</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">contract</span><span class="p">)</span>
        <span class="n">side_bytes</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">side</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;ASK&quot;</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span>
        <span class="n">max_fees_percent_bytes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_fees_percent</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">nonce_bytes</span>
            <span class="o">+</span> <span class="n">contract_id_bytes</span>
            <span class="o">+</span> <span class="n">quantity_bytes</span>
            <span class="o">+</span> <span class="n">side_bytes</span>
            <span class="o">+</span> <span class="n">price_bytes</span>
            <span class="o">+</span> <span class="n">max_fees_percent_bytes</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">payload</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_order_request_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nonce</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">quantity</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">,</span>
        <span class="n">side</span><span class="p">:</span> <span class="n">Side</span><span class="p">,</span>
        <span class="n">max_fees_percent</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">,</span>
        <span class="n">trigger_price</span><span class="p">:</span> <span class="n">Decimal</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">price</span><span class="p">:</span> <span class="n">Decimal</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">creation_deadline</span><span class="p">:</span> <span class="n">Decimal</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">twap_config</span><span class="p">:</span> <span class="n">TWAPConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent_order</span><span class="p">:</span> <span class="n">OrderIdVariant</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">order_flags</span><span class="p">:</span> <span class="n">OrderFlags</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">trigger_direction</span><span class="p">:</span> <span class="n">TriggerDirection</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the request data for placing an order.</span>

<span class="sd">        Args:</span>
<span class="sd">            nonce: Unique nonce for this order (defaults to current epoch timestamp in s)</span>
<span class="sd">            symbol: Trading symbol</span>
<span class="sd">            quantity: Order quantity</span>
<span class="sd">            side: Order side (BID/ASK)</span>
<span class="sd">            max_fees_percent: Maximum fees as percentage</span>
<span class="sd">            trigger_price: Trigger price for conditional orders (optional)</span>
<span class="sd">            price: Limit price (None for market orders)</span>
<span class="sd">            creation_deadline: Deadline for order creation in seconds (optional)</span>
<span class="sd">            twap_config: TWAP configuration for time-weighted orders (optional)</span>
<span class="sd">            parent_order: Parent order reference for child orders (optional)</span>
<span class="sd">            order_flags: Additional order flags (optional)</span>
<span class="sd">            trigger_direction: Direction for trigger activation (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Any]: The signed request data ready to send to the API</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">contract</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_contract</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__create_or_update_order_payload</span><span class="p">(</span>
            <span class="n">contract</span><span class="p">,</span> <span class="n">nonce</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="n">max_fees_percent</span><span class="p">,</span> <span class="n">price</span>
        <span class="p">)</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sign_payload</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="n">Side</span><span class="o">.</span><span class="n">BUY</span><span class="p">:</span>
            <span class="n">side</span> <span class="o">=</span> <span class="n">Side</span><span class="o">.</span><span class="n">BID</span>
        <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="n">Side</span><span class="o">.</span><span class="n">SELL</span><span class="p">:</span>
            <span class="n">side</span> <span class="o">=</span> <span class="n">Side</span><span class="o">.</span><span class="n">ASK</span>

        <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;nonce&quot;</span><span class="p">:</span> <span class="n">nonce</span><span class="p">,</span>
            <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="n">symbol</span><span class="p">,</span>
            <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="n">full_precision_string</span><span class="p">(</span><span class="n">quantity</span><span class="p">),</span>
            <span class="s2">&quot;orderType&quot;</span><span class="p">:</span> <span class="s2">&quot;MARKET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;side&quot;</span><span class="p">:</span> <span class="n">side</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;maxFeesPercent&quot;</span><span class="p">:</span> <span class="n">full_precision_string</span><span class="p">(</span><span class="n">max_fees_percent</span><span class="p">),</span>
            <span class="s2">&quot;signature&quot;</span><span class="p">:</span> <span class="n">signature</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;orderType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LIMIT&quot;</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_precision_string</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trigger_price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;triggerPrice&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_precision_string</span><span class="p">(</span><span class="n">trigger_price</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">trigger_direction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">request</span><span class="p">[</span><span class="s2">&quot;triggerDirection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trigger_direction</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="n">twap_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">request</span> <span class="o">|</span> <span class="n">twap_config</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">creation_deadline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;creationDeadline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">absolute_creation_deadline</span><span class="p">(</span><span class="n">creation_deadline</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;parentOrder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_order</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">order_flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;orderFlags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">order_flags</span><span class="o">.</span><span class="n">value</span>

        <span class="k">return</span> <span class="n">request</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__update_order_request_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">order_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">nonce</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">quantity</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">,</span>
        <span class="n">side</span><span class="p">:</span> <span class="n">Side</span><span class="p">,</span>
        <span class="n">max_fees_percent</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">,</span>
        <span class="n">price</span><span class="p">:</span> <span class="n">Decimal</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">trigger_price</span><span class="p">:</span> <span class="n">Decimal</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">creation_deadline</span><span class="p">:</span> <span class="n">Decimal</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">order_flags</span><span class="p">:</span> <span class="n">OrderFlags</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the request data for updating an existing order.</span>

<span class="sd">        Args:</span>
<span class="sd">            order_id: The ID of the order to update</span>
<span class="sd">            nonce: Unique nonce for this update (defaults to current epoch timestamp in s)</span>
<span class="sd">            symbol: Trading symbol</span>
<span class="sd">            quantity: Updated order quantity</span>
<span class="sd">            side: Order side (BID/ASK)</span>
<span class="sd">            max_fees_percent: Maximum fees as percentage</span>
<span class="sd">            price: Updated limit price (optional)</span>
<span class="sd">            trigger_price: Updated trigger price (optional)</span>
<span class="sd">            creation_deadline: Deadline for update in seconds (optional)</span>
<span class="sd">            order_flags: Additional order flags (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Any]: The signed request data ready to send to the API</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">contract</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_contract</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__create_or_update_order_payload</span><span class="p">(</span>
            <span class="n">contract</span><span class="p">,</span> <span class="n">nonce</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="n">max_fees_percent</span><span class="p">,</span> <span class="n">price</span>
        <span class="p">)</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sign_payload</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;nonce&quot;</span><span class="p">:</span> <span class="n">nonce</span><span class="p">,</span>
            <span class="s2">&quot;maxFeesPercent&quot;</span><span class="p">:</span> <span class="n">full_precision_string</span><span class="p">(</span><span class="n">max_fees_percent</span><span class="p">),</span>
            <span class="s2">&quot;signature&quot;</span><span class="p">:</span> <span class="n">signature</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">quantity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;updatedQuantity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_precision_string</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;quantity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_precision_string</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;updatedPrice&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_precision_string</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_precision_string</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">order_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;orderId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trigger_price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;updatedTriggerPrice&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_precision_string</span><span class="p">(</span><span class="n">trigger_price</span><span class="p">)</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;trigger_price&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_precision_string</span><span class="p">(</span><span class="n">trigger_price</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">creation_deadline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;creationDeadline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">absolute_creation_deadline</span><span class="p">(</span><span class="n">creation_deadline</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">order_flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;orderFlags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">order_flags</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">request</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__cancel_order_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nonce</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the binary payload for canceling an order.</span>

<span class="sd">        Args:</span>
<span class="sd">            order_id: The order ID to cancel (optional)</span>
<span class="sd">            nonce: The order nonce to cancel (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            bytes: The binary payload to be signed</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If neither order_id nor nonce is provided</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">order_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">order_id</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nonce</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span> <span class="kn">from</span><span class="w"> </span><span class="nn">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;either of &#39;order_id&#39; or &#39;nonce&#39; must be non-None&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">nonce</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cancel_order_request_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">order_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nonce</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nonce_as_str</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the request data for canceling an order.</span>

<span class="sd">        Args:</span>
<span class="sd">            order_id: The order ID to cancel (optional)</span>
<span class="sd">            nonce: The order nonce to cancel (optional)</span>
<span class="sd">            nonce_as_str: Whether to format nonce as string (default True)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Any]: The signed request data ready to send to the API</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cancel_order_payload</span><span class="p">(</span><span class="n">order_id</span><span class="p">,</span> <span class="n">nonce</span><span class="p">)</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sign_payload</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;signature&quot;</span><span class="p">:</span> <span class="n">signature</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">order_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;orderId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;nonce&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nonce</span><span class="p">)</span> <span class="k">if</span> <span class="n">nonce_as_str</span> <span class="k">else</span> <span class="n">nonce</span>  <span class="c1"># type: ignore</span>
        <span class="k">return</span> <span class="n">request</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__batch_order_request_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">nonce</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="n">CreateOrder</span> <span class="o">|</span> <span class="n">UpdateOrder</span> <span class="o">|</span> <span class="n">CancelOrder</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JsonObject</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create request data for a batch order operation.</span>

<span class="sd">        Args:</span>
<span class="sd">            nonce: Base nonce for this operation</span>
<span class="sd">            o: The order operation (CreateOrder, UpdateOrder, or CancelOrder)</span>

<span class="sd">        Returns:</span>
<span class="sd">            JsonObject: The request data with action type included</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If the order type is not recognized</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">is</span> <span class="n">CreateOrder</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_order_request_data</span><span class="p">(</span>
                <span class="n">nonce</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">quantity</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">side</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">max_fees_percent</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">trigger_price</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">price</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">creation_deadline</span><span class="p">,</span>
                <span class="n">twap_config</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">twap_config</span><span class="p">,</span>
                <span class="n">order_flags</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">order_flags</span><span class="p">,</span>
                <span class="n">parent_order</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">parent_order</span><span class="p">,</span>
                <span class="n">trigger_direction</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">trigger_direction</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">is</span> <span class="n">UpdateOrder</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__update_order_request_data</span><span class="p">(</span>
                <span class="n">o</span><span class="o">.</span><span class="n">order_id</span><span class="p">,</span>
                <span class="n">nonce</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">quantity</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">side</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">max_fees_percent</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">price</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">trigger_price</span><span class="p">,</span>
                <span class="n">o</span><span class="o">.</span><span class="n">creation_deadline</span><span class="p">,</span>
                <span class="n">order_flags</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">order_flags</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">is</span> <span class="n">CancelOrder</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_order_request_data</span><span class="p">(</span>
                <span class="n">order_id</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">order_id</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">nonce</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span> <span class="kn">from</span><span class="w"> </span><span class="nn">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected request type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">action</span>
        <span class="k">return</span> <span class="n">payload</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Hibachi Engineering Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>